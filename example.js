import { SMARTHealthCard } from "./SMARTHealthCard.js";

const shc = "shc:/56762909524320603460206037244126286074582864257045762809282229254077280433602870282229695242366034602060456125055225253634421235426471675527637645064108536325753661375941645807553963074405447755050303364045263326254255762912010841313153717074243574415810062624734174293564427162205752283220395571235321584037546232382527583609585309330077673436603033310303637025275339520756773231211136337445714100596610422205543977385233366452656127313725376709311028365232447567556925215771072134316534544145707074412656535466035911082866572620102663581127270660122128667205372442263524384209325250644472033139506365282957381257746570417704317634672665643941265835303067457406693160576160096571265355234127696500756939754126200661062240562410505010436926112422392334616530537055695221635944202505342830602620552924245850392900074029396660734265613264424231355645543539735821717421385460423823453934373309776158605862586072572161033207414155657243294336663069612800712306617106384172115477646133556735356664523603757360360462384142400976374507752933031143685653062943504100002603657559316977217632272038773122750429293976656904377740752341543510536545653970447656530803703200613022306372126173286152116056650774083536003937305444266435445926740831426930756364734121081235243540083709653766567372064322071130575873073543702012347103593172554121256825400924235754232830247223005050503912112409332112405635631055432504235561084566567604620640076077303203767469436658045036126031555507110912617755340311680329656254013639270961306732371145032703213162271265536630732767233426080864046076052960645007247358445643100755225065426835290368095311755008585807296957717141271211234035065970455258";
const dec = SMARTHealthCard.decode(shc);
console.log(dec);
console.log(dec.payload.vc.credentialSubject.fhirBundle.entry);
const res = await SMARTHealthCard.verify(dec);
console.log("verify by the pubkey from web", res);

//const jwks = await (await fetch("./vc_vrs_digital_go_jp_issuer_well-known_jwks.json")).json();
const jwks = JSON.parse(await Deno.readTextFile("./vc_vrs_digital_go_jp_issuer_well-known_jwks.json"));
const res2 = await SMARTHealthCard.verify(dec, jwks);
console.log("verify by fetched pubkey", res2);

const data = await SMARTHealthCard.toStringEntry(dec);
console.log(data);
